---
navigation:
  title: 'Build a website use Nuxt Content with Nuxt Studio'
  description: '使用Nuxt Content将网站静态化，使用Nuxt Studio在线笔记文章。'
  date: '2024-1-14'
  cover: 'https://r2-img.lnbiuc.com/blog/2024/01/58f119670b5902290a2063d181550d58.png'
  tags: ['nuxt']
---

## 为什么要静态化网站

### 服务器成本
之前的网站，使用了两台服务器进行部署，其中前端Nuxt和后端api及数据库MongoDB，Redis部署在99元一年的阿里云服务器上。网关Nginx部署在了腾讯云服务器上。为什么要使用两台服务器呢？请看下文。

### 速度提升

但是由于阿里云服务器没有备案，所以不能直接访问阿里云服务器，机房会检查Http header中的refer字段，如果监测到未备案的域名会屏蔽访问。
同时由于我使用了腾讯云的CDN，在设置源站时，强制要求设置refer字段，所以我不得不再使用一台已经备案的服务器作为中继，每次先请求腾讯云这边已经备案过的服务器，再经过Nginx转发（转发时会清空refer字段，绕过机房的检测）。这样以来，虽然麻烦了些，但是至少能用。

然而不知是腾讯云的CDN太慢还是两台主机直接的转发消耗了太过的时间，导致后端Api接口响应速度非常慢，平均下来有500ms的延迟，起初我努力优化接口，使用精确且严格的Redis缓存配置，在本地调试时，接口的速度和本地Ping服务器的响应速度相当，我以为这样能大幅提高Api响应速度。然而优化后接口响应速度仍然高达400ms，提升效果甚微。经过我三分钟的思考，从本地请求到上海腾讯云机房的Nginx，再从上海到成都阿里云机房的后端，请求到达服务器就花费了90ms延迟，再由服务器处理之后返回又🈶90ms的延迟，再加上腾讯云在西安没有节点，最近的节点在郑州，所以一条请求从发出到返回经过了：西安 -> 郑州 -> 成都 -> 上海 -> 成都 -> 郑州 -> 西安，时间全部浪费在路上了。

使用静态化网站之后，返回前端的是已经渲染好的页面，感官上速度是比先看加载进度条，在渲染数据是要快的。

### SEO友好

我最早的网站使用vue来写的，vue能做的seo优化极其有限，作为一个以内容为之的网站，这是不可接受的。在去年三月初就有了使用SSR方案的想法，但是由于当时时间紧迫，还有毕设要做，所以一直拖到了10月才开始使用Nuxt重写网站。第一版的时候，SEO已经很优秀了，浏览器lighthouse能达到100分，也适用了og:image，twitter:image来添加预览图像。但是正如前文所说，接口响应速度太慢，这才进行了第三次重写。

### CDN加速

SSR的优势是直接返回前端完整的页面，即HTML文件，CDN可以缓存这些静态文件，减轻源站压力同时还能做到全球分发，其实我已经使用Serveless了，不在乎源站压力。

### 数据丢失

服务器也有到期，宕机的风险，文章保存在数据库中，我是没有什么安全感的，特别是经历过两次数据库被请空，勒索比特币的时候。相比于单台数据库，将文章保存在Github，Amazon S3，或者OneDrive更不易丢失。

## 静态化的缺点

- 不能实时更新，至少需要2分钟经过Build和Deploy，才能看到修改的结果。
- 不方便统计文章访问量等信息。
- 不方便上传文件，需要手动将图片上传到public目录下，不如直接粘贴自动上传来的方便。
- 不能实时保存。

## 技术选型

关于静态网站已经有很多现有的产品了，最早的Hexo，到21年才发布的Astro均可以生成静态网站，除此之外，还有Nuxt Content， Vuepress，VitePress等。这些工具，框架有优点也有缺点，学习成本高，自定义程度低。

在我收集以上这些信息时，我发现了Nuxt Studio，它提供了一个在线界面，可以和部署的网站链接，实时预览编辑内容，同时还方便进行Git提交，历史版本查看，这样以来静态的网站可以和动态的做到差不多的体验，甚至更好。

再也不用每次写文章都得在项目的文件夹中找到地址，打开Typroa写完在git add，git comment，直接在网站写好点保存就完事了，这太棒了，完全符合我对博客网站的需求。

除此之外，可自定义和可扩展性极高。
- 自定义：整个项目就是一个Nuxt项目，在使用Nuxt Content提供的功能之上还可以使用任何你需要的技术。
- 扩展性：对mdx的支持和新增的语法，可以直接在md中调用已经编写好的组件，需要什么样式完全可以自己写，需要在md中插入视频，卡片都可以自定义。

## 构建项目

在我发先这么好用的工具之后，没有拖延，立刻开始新建项目，将之前的文章新写一个接口导出。将已有网站的样式复制到新项目中。很快，仅仅三四个小时我便完成了最初版。

然而，事情并不是一帆风顺的。Nxut Content存在很严重的Bug，并且我没有找到已有的解决方案，只好自己试。就这样，我从晚上9点开始，直到早上10点才完完成。

我在构建项目时，按照我的习惯，基于antfu的vitess模版，一边看文章一边将旧项目的样式复制过来，同时再做一些小修改。

## 问题

### NuxtUI Pro

我遇到的第一个问题是，Nuxt Content使用的，通过文章生成目录的组件居然是收费购买的，OK，到这里没什么，价格不贵我愿意买，当时对项目的支持。然而当我看到价格时，199，刀。按照现在的汇率7.11，这个UI框架的几个组件居然卖到了1415.01元，我明白这歌价格中不止包含了开发的费用，然而这极大的超过了我的承受能力，如果是199，我可能会支持下。

![](https://r2-img.lnbiuc.com/blog/2024/01/aaa15564ecb1ab4e7a739ba12c96d161.png)

### H1不生成目录

我不明白，也不理解，为什么H1不算在目录里，可能国外用H1当标题比较多？但是这至少是可以配置的吧。然而，我在Github Issue中看到，这居然是个Feature？？？

[https://github.com/nuxt/content/issues/1791#issuecomment-1425731336](https://github.com/nuxt/content/issues/1791#issuecomment-1425731336)

![](https://r2-img.lnbiuc.com/blog/2024/01/d81184f8b47100400fbee0f3cdada5e6.png)

### Nuxt Generate报错

不知道为何是404，给的错误信息中有用的部分很少，Issue中找到了同样的问题，但是没找到有用的解决方案。

倒是找的了个掩耳盗铃的方案，config中增加prerender配置，使在报错的情况下仍然生成，看不见 === 没错。肯定的是这样生成的文件肯定是无法正常运行的。

```javascript
export default defineNuxtConfig({
  nitro: {
    esbuild: {
      options: {
        target: 'esnext',
      },
    },
    prerender: {
      concurrency: 1,
      failOnError: false,
    },
  },
})
```

![](https://r2-img.lnbiuc.com/blog/2024/01/00ff9b9542b56c20aee07851789295f1.png)

### 客户端渲染失效

又是一个玄学问题，客户端加载完成之后，点击路由跳转之后，组件不渲染，必须要手动刷新一次，由服务器渲染才行。早在开发过程中就注意到这个问题了，然而并没有引起注意，以为部署之后就没事了，然而这才是噩梦的开始。

部署之后仍然有这个问题，在Issue找了好久，只找到里一个回复，现在已经找不到了。里边提到进入路由之后需要手动刷新一次才渲染。并没有找到有效的解决方案。

为了解决这个问题，我重新找了个Nuxt官网的template，之后将我的样式，文章一个一个复制到template项目中，复制一个就测试一次。直到最后，我才发现是<NuxtLayout>的问题。只要使用了<NuxtLayout>百分之100触发这个bug？就很迷惑，Nuxt项目不能使用Nuxtlayout！

处理完这些问题已经是第二天早上10点了。总算是完成了。

后续功能仍在开发中。。。

最后，既然选择了最新的技术，最新的开源项目，就要做好试错的准备，虽然遇到了这么多问题，但是最后不都解决了不是吗。

## Feature Request

- 希望可以在NuxtStudio中直接粘贴图片
























